<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>身份认证系统</title>
</head>
<body>
    <form>
        <label>姓名：</label>
        <input type="text" id="name"><br>
        <label>身份证号码：</label>
        <input type="text" id="idcard"><br>
        <label>校验码：</label>
        <input type="text" id="checkcode" maxlength="1"><br>
        <button type="button" onclick="verify()">验证</button>
    </form>
    <script>
        // function verify() {
        //     // 获取姓名、身份证号码以及校验码
        //     const name = document.getElementById('name').value;
        //     const idcard = document.getElementById('idcard').value;
        //     const checkcode = document.getElementById('checkcode').value;

        //     // 发送认证请求
        //     fetch('/api/verify', {
        //         method: 'POST',
        //         headers: {
        //             'Content-Type': 'application/json'
        //         },
        //         body: JSON.stringify({
        //             name: name,
        //             idcard: idcard,
        //             checkcode: checkcode
        //         })
        //     })
        //         .then(response => response.json())
        //         .then(data => {
        //             // 认证成功，显示身份信息
        //             const info = `姓名：${data.name}<br>性别：${data.gender}<br>出生日期：${data.birthday}`;
        //             document.getElementById('result').innerHTML = info;
        //         })
        //         .catch(error => {
        //             console.error('认证失败：' + error);
        //         });
        // }

        /**
         * 判断身份证号码是否合法
         * @param {string} idcard 身份证号码
         * @returns {boolean} 合法返回 true，否则返回 false
        */
        function isValidIdCard(idcard) {
            if (!idcard) {
                return false;
            }
            // 身份证号码共18位，前17位是数字，最后一位可能是数字或者字母X
            const regex = /^[1-9][0-9]{16}([0-9]|[xX])$/;
            return regex.test(idcard);
        }

        function verify() {
            // 获取姓名、身份证号码以及校验码
            const name = document.getElementById('name').value;
            const idcard = document.getElementById('idcard').value;

            const checkcode = document.getElementById('checkcode').value;  // 校验码，感觉没用

            if (!isValidIdCard(idcard)) {
                alert('请输入正确的身份证号码！');
                return;
            }

            // 发送认证请求
            fetch('/api/verify', {                      // fetch() 方法用于发送请求,里面的参数是请求的地址
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: name,
                    idcard: idcard,
                    checkcode: checkcode
                })
            })
                .then(response => response.json())
                .then(data => {
                    // 认证成功，显示身份信息
                    const info = `姓名：${data.name}<br>性别：${data.gender}<br>出生日期：${data.birthday}`;
                    document.getElementById('result').innerHTML = info;
                })
                .catch(error => {
                    console.error('认证失败：' + error);
                });
        }

        // 测试正则表达式是否生效

        // function test() {
        //     let idcard = '3622011990022554632'
        //     const regex = /^[1-9][0-9]{16}([0-9]|[xX])$/;
        //     let a = regex.test(idcard);
        //     console.log(a);
        // }
    </script>
    <div id="result"></div>
</body>
</html>